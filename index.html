<!doctype html>
<html lang="en">

<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- COMMON TAGS -->
    <meta charset="utf-8">
    <title>platacomocancha.pe</title>
    <!-- Search Engine -->
    <meta name="description" content="Encuentra el porcentaje de hogares tienen menos ingresos que el tuyo">
    <!-- Schema.org for Google -->
    <meta itemprop="name" content="platacomocancha.pe">
    <meta itemprop="description" content="Encuentra el porcentaje de hogares tienen menos ingresos que el tuyo">
    <!-- Twitter -->
    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="platacomocancha.pe">
    <meta name="twitter:description" content="Encuentra el porcentaje de hogares tienen menos ingresos que el tuyo">
    <!-- Open Graph general (Facebook, Pinterest & Google+) -->
    <meta name="og:title" content="platacomocancha.pe">
    <meta name="og:description" content="Encuentra el porcentaje de hogares tienen menos ingresos que el tuyo">
    <meta name="og:url" content="platacomocancha.pe">
    <meta name="og:site_name" content="platacomocancha.pe">
    <meta name="og:locale" content="es_PE">
    <meta name="og:type" content="website">

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-+0n0xVW2eSR5OomGNYDnhzAbDsOXxcvSN1TPprVMTNDbiYZCxYbOOl7+AMvyTG2x" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.3.2/dist/chart.min.js"
        integrity="sha256-qoN08nWXsFH+S9CtIq99e5yzYHioRHtNB9t2qy1MSmc=" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation@1.0.2/dist/chartjs-plugin-annotation.min.js"
        integrity="sha256-uqQH1xoI6lRYGUAVzCWIe8t8dB40UkmA20G2N+scO5o=" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-gtEjrD/SeCtmISkJkNUaaKMoLD0//ElJ19smozuHV6z3Iehds+3Ulb9Bn9Plx0x4"
        crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.slim.min.js" integrity="sha512-6ORWJX/LrnSjBzwefdNUyLCMTIsGoNP6NftMy2UAm1JBm6PRZCO1d7OHBStWpVFZLO+RerTvqX/Z9mBFfCJZ4A==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-VZ6MS6T4XZ"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());

        gtag('config', 'G-VZ6MS6T4XZ');
    </script>
    <title>platacomocancha.pe: Encuentra el porcentaje de hogares tienen menos ingresos que el de tu hogar:</title>
</head>

<body>
    <div class="col-lg-8 mx-auto p-3 py-md-5">
        <header class="d-flex align-items-center pb-3 mb-5 border-bottom">
            <a href="/" class="d-flex align-items-center text-dark text-decoration-none">
                <span class="fs-4">platacomocancha.pe</span>
            </a>
        </header>

        <main>
            <h3>Ingresos familiares mensuales</h3>
            <div class="row">
                <label for="income" class="col-auto col-form-label">Encuentra el porcentaje de hogares que tienen menos ingresos que el de tu hogar (bruto en S/.):</label>
                <div class="col-auto">
                  <input type="text" class="form-control" id="income">
                </div>
            </div>

            <div class="row">
                <div class="col-auto"  id="income-pct">
                </div>
            </div>
            <div class="row">
                <div class="col-auto"  id="income-link">
                </div>
            </div>

            <div class="container py-3">
                <div class="row">
                    <div class="col-12">
                        <div class="card">
                                                    <div class=" card-body">
                            <canvas id="myChart" width="400" height="200"></canvas>
                        </div>
                        <div class="card-footer">
                            <span class="px-1">
                                NSE E
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="rgb(201, 203, 207)"
                                    class="bi bi-square-fill" viewBox="0 0 16 16">
                                    <path d="M0 2a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V2z"></path>
                                </svg>
                            </span>
                            <span class="px-1">
                                NSE D
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="rgb(153, 102, 255)"
                                    class="bi bi-square-fill" viewBox="0 0 16 16">
                                    <path d="M0 2a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V2z"></path>
                                </svg>
                            </span>
                            <span class="px-1">
                                NSE C
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="rgb(255, 205, 86)"
                                    class="bi bi-square-fill" viewBox="0 0 16 16">
                                    <path d="M0 2a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V2z"></path>
                                </svg>
                            </span>
                        
                            <span class="px-1">
                                NSE B
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="rgb(75, 192, 192)"
                                    class="bi bi-square-fill" viewBox="0 0 16 16">
                                    <path d="M0 2a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V2z"></path>
                                </svg>
                            </span>
                        
                            <span class="px-1">
                                NSE A
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="rgb(54, 162, 235)"
                                    class="bi bi-square-fill" viewBox="0 0 16 16">
                                    <path d="M0 2a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V2z"></path>
                                </svg>
                            </span>
                        </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="row py-3">
                <h4>Preguntas Frequentes</h4>
                <div class="accordion accordion-flush" id="accordionFlushExample">
                    <div class="accordion-item">
                      <h2 class="accordion-header" id="flush-headingOne">
                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseOne" aria-expanded="false" aria-controls="flush-collapseOne">
                        ¿De dónde salen éstos números? 
                        </button>
                      </h2>
                      <div id="flush-collapseOne" class="accordion-collapse collapse" aria-labelledby="flush-headingOne" data-bs-parent="#accordionFlushExample">
                        <div class="accordion-body">
                            Los números están basados en los NSE (Niveles Socio-Ecónimos) usados por Ipsos en sus encuestas, que usan datos oficiales del 2017-2018 (<a href="https://www.ipsos.com/es-pe/caracteristicas-de-los-niveles-socioeconomicos-en-el-peru">leer más</a>). Con unos pequeños cambios:
                            <ul>
                                <li>Ipsos describe a los NSE con ingresos promedios. Ej: NSE A (2% de hogares) tiene un ingreso promedio de S/.12,660</li>
                                <li>Para transformar los promedios de cada NSE, asumo que los ingresos siguen una curva logarítmica, tal que el límite entre dos NSEs consecutivos es el promedio de los promedios de ambos NSEs.</li>
                                <li>Los pasos para el punto anterior pueden ser revisados en este <a href="https://docs.google.com/spreadsheets/d/1UtNkBCMaF8IlNYZBIUTdKeWXjG9cNpJf38kHwkFMUkg/edit?usp=sharing">spreadsheet de Google</a></li>
                            </ul>
                            Estoy 100% seguro que los datos generados no son exactos, pero son más que suficientes para objetivos didácticos.
                        </div>
                      </div>
                    </div>
                    <div class="accordion-item">
                      <h2 class="accordion-header" id="flush-headingOne">
                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseOne" aria-expanded="false" aria-controls="flush-collapseOne">
                        ¿Los ingresos mensuales son brutos o netos? 
                        </button>
                      </h2>
                      <div id="flush-collapseOne" class="accordion-collapse collapse" aria-labelledby="flush-headingOne" data-bs-parent="#accordionFlushExample">
                        <div class="accordion-body">
                            Los ingresos son brutos (antes de impuestos). Los ingresos son tomados por Ipsos de la Encuesta Nacional de Hogares (Enaho 2018).
                      </div>
                    </div>
                    <div class="accordion-item">
                      <h2 class="accordion-header" id="flush-headingTwo">
                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseTwo" aria-expanded="false" aria-controls="flush-collapseTwo">
                         ¿Existe una mejor forma de calcular los datos?
                        </button>
                      </h2>
                      <div id="flush-collapseTwo" class="accordion-collapse collapse" aria-labelledby="flush-headingTwo" data-bs-parent="#accordionFlushExample">
                        <div class="accordion-body">
                            Por supuesto. Se puede recrear todo el trabajo de Ipsos. Si estás interesado en hacerlo, <a href="https://github.com/platacomocancha/platacomocancha.github.io">se aceptan contribuciones en Github</a>.
                        </div>
                      </div>
                    </div>
                  </div>
            </div>
    </div>
    <script>
        var incomeData = [
            // NSE E
            0, 584.258678, 608.5126935, 633.0154724, 657.7721706, 682.788106, 708.0687652, 733.6198109, 759.4470894, 785.5566389, 811.9546976, 838.6477127, 865.6423502, 892.9455045, 920.5643093, 948.5061482, 976.7786676, 1005.389788, 1034.347718, 1063.660969, 1093.33837, 1123.38908, 1153.822613, 1184.648847, 1215.87805, 1247.520897, 1279.588492, 1312.092395, 1345.044642, 1378.457774, 1412.344867, 1446.719561, 1481.596092, 1516.989332,
            // NSE D
            1552.914821, 1589.388812, 1626.428314, 1664.051139, 1702.275954, 1741.122338, 1780.610841, 1820.763047, 1861.601648, 1903.150521, 1945.434811, 1988.48102, 2032.317113, 2076.972619, 2122.478756, 2168.868563, 2216.17704, 2264.441308, 2313.700785, 2363.99738, 2415.375704, 2467.883312, 2521.570965, 2576.492924, 2632.707282, 2690.276333, 2749.266984,
            // NSE C
            2809.751227, 2871.806664, 2935.517107, 3000.973256, 3068.273481, 3137.524707, 3208.843436, 3282.356928, 3358.204568, 3436.539455, 3517.530262, 3601.363425, 3688.245727, 3778.407371, 3872.105654, 3969.629399, 4071.304318, 4177.499579, 4288.635896, 4405.195598, 4527.735279, 4656.90187, 4793.453321, 4938.285543, 5092.46807, 5257.29204, 5434.335985,
            // NSE B
            5625.558014, 5833.428193, 6061.124213, 6312.830485, 6594.214157, 6913.220654, 7281.486628, 7717.052827, 8250.142771, 8937.415242,
            // NSE A
            9906.071386, 11562, 25000];
        var incomeLabels = [
            // NSE E
            '0%', '1%', '2%', '3%', '4%', '5%', '6%', '7%', '8%', '9%', '10%', '11%', '12%', '13%', '14%', '15%', '16%', '17%', '18%', '19%', '20%', '21%', '22%', '23%', '24%', '25%', '26%', '27%', '28%', '29%', '30%', '31%', '32%', '33%',
            // NSE D
            '34%', '35%', '36%', '37%', '38%', '39%', '40%', '41%', '42%', '43%', '44%', '45%', '46%', '47%', '48%', '49%', '50%', '51%', '52%', '53%', '54%', '55%', '56%', '57%', '58%', '59%', '60%',
            // NSE C
            '61%', '62%', '63%', '64%', '65%', '66%', '67%', '68%', '69%', '70%', '71%', '72%', '73%', '74%', '75%', '76%', '77%', '78%', '79%', '80%', '81%', '82%', '83%', '84%', '85%', '86%', '87%',
            // NSE B
            '88%', '89%', '90%', '91%', '92%', '93%', '94%', '95%', '96%', '97%',
            // NSE A
            '98%', '99%', '99.7%'
            ];
            var color = {
                red: 'rgb(255, 99, 132)',
                orange: 'rgb(255, 159, 64)',
                yellow: 'rgb(255, 205, 86)',
                green: 'rgb(75, 192, 192)',
                blue: 'rgb(54, 162, 235)',
                purple: 'rgb(153, 102, 255)',
                grey: 'rgb(201, 203, 207)'
            };
        var incomeDataColors = [color.grey, color.grey, color.grey, color.grey, color.grey, color.grey, color.grey, color.grey, color.grey, color.grey, color.grey, color.grey, color.grey, color.grey, color.grey, color.grey, color.grey, color.grey, color.grey, color.grey, color.grey, color.grey, color.grey, color.grey, color.grey, color.grey, color.grey, color.grey, color.grey, color.grey, color.grey, color.grey, color.grey, color.grey, color.purple, color.purple, color.purple, color.purple, color.purple, color.purple, color.purple, color.purple, color.purple, color.purple, color.purple, color.purple, color.purple, color.purple, color.purple, color.purple, color.purple, color.purple, color.purple, color.purple, color.purple, color.purple, color.purple, color.purple, color.purple, color.purple, color.purple, color.yellow, color.yellow, color.yellow, color.yellow, color.yellow, color.yellow, color.yellow, color.yellow, color.yellow, color.yellow, color.yellow, color.yellow, color.yellow, color.yellow, color.yellow, color.yellow, color.yellow, color.yellow, color.yellow, color.yellow, color.yellow, color.yellow, color.yellow, color.yellow, color.yellow, color.yellow, color.yellow, color.green, color.green, color.green, color.green, color.green, color.green, color.green, color.green, color.green, color.green, color.blue, color.blue, color.blue];
        
        var ctx = document.getElementById('myChart');

        const myChart = new Chart(ctx, {
            type: 'bar',
            data: {
                labels: incomeLabels,
                datasets: 
                    [{
                    label: 'Ingreso Familiar mensual (S/.)',
                    data: incomeData,
                    backgroundColor: incomeDataColors,
                    fill: false,
                    borderColor: 'rgb(153, 102, 255)',
                    tension: 0.1
                }]
            },
            options: {
                scales: {
                    y: {
                        beginAtZero: true
                    }
                },
                plugins: {
                    annotation: {
                        drawTime: 'afterDatasetsDraw',
                        annotations: {
                            incomeLine: {
                                type: 'line',
                                id: 'vline',
                                mode: 'vertical',
                                scaleID: 'x',
                                value: '',
                                borderColor: 'green',
                                borderWidth: 1,
                                label: {
                                    enabled: true,
                                    position: "center",
                                    content: ''
                                }
                            }
                        }
                    }
                }
            }
        });
        

        function updateIncomeAnnotation(chart, incomeLabel, incomeAmount) {
            chart.options.plugins.annotation.annotations.incomeLine.value = incomeLabel;
            chart.options.plugins.annotation.annotations.incomeLine.label.content =  "S/. " + incomeAmount;
            chart.update();
        }

        function updateChartWithIncome(chart, income) {
            if (!isNaN(income)) {
                var label = incomeLabels[incomeData.length-1];
                for (i = 0; i < incomeData.length; i++) {
                    if (income < incomeData[i]) {
                        label = incomeLabels[i-1];
                        break;
                    }
                }
                $('#income-pct').html(`<strong>Tu ingreso familiar es mayor al ${ label } de hogares peruanos</strong>`);
                $('#income-link').html(`Compartelo como link: <a href="https://platacomocancha.pe/?income=${ income }">https://platacomocancha.pe/?income=${ income }</a>`);
                updateIncomeAnnotation(myChart, label ,income);
            }
            else {
                $('#income-pct').text("Por favor, ingresa un número");
                $('#income-link').text("");
            }
        }

        $('input[id="income"]').keyup(function(){
            var income = $(this).val();
            updateChartWithIncome(myChart, income)
        });

        // As soon as we load, set the given income
        var searchParams = new URLSearchParams(window.location.search);
        if (searchParams.has("income")) {
            var providedIncome = searchParams.get("income");
            document.getElementById("income").value = providedIncome;
            updateChartWithIncome(myChart, providedIncome)
        }
    </script>


    </main>
    <footer class="pt-5 my-5 text-muted border-top">
        platacomocancha.pe &middot; &copy; 2021
    </footer>
    </div>

</body>

</html>
